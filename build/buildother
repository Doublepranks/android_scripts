#!/bin/bash
# Written by Sean Donovan (swordrune10)

if [ ! "$INIT" ]; then
	cd $(dirname $0)
	export SCRIPT=$(echo "buildother")
	../headerfile
	exit 0
fi

menu () {
clear

echo "Swordrune10's Android Kitchen!"
echo "=============================="
echo "Build other device is selected to be built!"
echo ""
echo "Which android repository are we building from today?"
echo "  1. Android Open Kang Project repository"
echo "  2. Android Open Source Project repository 4.3"
echo "  3. Android Open Source Project repository 4.4"
echo "  4. Carbon repository"
echo "  5. Cyanogenmod 10.2 repository"
echo "  6. Cyanogenmod 11 repository"
echo "  7. Evervolv repository"
echo "  8. omnirom repository"
echo "  9. PAC-man repository"
echo "  10. ParanoidAndroid repository"
echo "  11. Go Back"
read version

if [ ! "$version" ] || ( echo $version | grep -q [A-Za-z] ) || [ $version -gt "11" ]; then
	echo ""
	echo "You did not make a proper selection, try again!"
	read -p "Press Enter to continue: " done
	menu
fi

if [ $version == "1" ]; then
	repodefine=$(echo "aokp")
	. repodefiner
fi

if [ $version == "2" ]; then
	repodefine=$(echo "aosp43")
	. repodefiner
fi

if [ $version == "3" ]; then
	repodefine=$(echo "aosp")
	. repodefiner
fi

if [ $version == "4" ]; then
	repodefine=$(echo "carbon")
	. repodefiner
fi

if [ $version == "5" ]; then
	repodefine=$(echo "cm10")
	. repodefiner
fi

if [ $version == "6" ]; then
	repodefine=$(echo "cm")
	. repodefiner
fi

if [ $version == "7" ]; then
	repodefine=$(echo "evervolv")
	. repodefiner
fi

if [ $version == "8" ]; then
	repodefine=$(echo "omni")
	. repodefiner
fi

if [ $version == "9" ]; then
	repodefine=$(echo "pacman")
	. repodefiner
fi

if [ $version == "10" ]; then
	repodefine=$(echo "paranoid")
	. repodefiner
fi

if [ $version == "11" ]; then
	echo ""
	read -p "Returning to Build Menu, Press Enter to continue: " done
	exit 0
fi

if ( ! find $REPOS/$script_repo-$repo_platform -maxdepth 1 &> /dev/null ); then
	echo ""
	echo "The selected android repository is not setup!"
	read -p "Press Enter to continue: " done
	menu
fi

clear

echo "Swordrune10's Android Kitchen!"
echo "=============================="
echo "Please type in which device you would like to build"
echo "Type in list to see all supported devices"
echo "Type in exit to go back"
read script_device

if [ ! "$script_device" ]; then
	echo ""
	echo "You did not make a proper selection, try again!"
	read -p "Press Enter to continue: " done
	menu
fi

while [ $script_device == "list" ]; do
	clear

	echo "Device List"
	echo "==========="

	if [ $script_repo == "aokp" ]; then
		cat $REPOS/aokp-$repo_platform/vendor/aokp/vendorsetup.sh | grep "add_lunch_combo" | \
		sed 's/.*aokp_//' | sed 's/-userdebug//' | sed "/combo.*/d"
	fi

	if [ $script_repo == "aosp" ]; then
		for vendorsetup in `ls $REPOS/aosp-$repo_platform/script_device/*/*/vendorsetup.sh 2> /dev/null`
		do
			cat $vendorsetup | grep "add_lunch_combo" | sed 's/.*aosp_//' | \
			sed 's/-userdebug//' | sed 's/.*full_//' | sed "/combo.*/d"
		done
	fi

	if [ $script_repo == "carbon" ]; then
		cat $REPOS/carbon-$repo_platform/vendor/carbon/vendorsetup.sh | grep "add_lunch_combo" | \
		sed 's/.*carbon_//' | sed 's/-userdebug//' | sed "/combo.*/d"	
	fi

	if [ $script_repo == "cm" ] && [ $repo_platform == "10.2" ]; then
		cat $LOCAL/config/cm-master-list | grep "10.2" | sed "s/cm_//" | \
		sed "/#/d" | sed "/^$/d" | sed 's/-userdebug//' | sed "s/cm-10.2.*//"
	fi

	if [ $script_repo == "cm" ] && [ $repo_platform == "11" ]; then
		cat $LOCAL/config/cm-master-list | grep "11.0" | sed "s/cm_//" | \
		sed "/#/d" | sed "/^$/d" | sed 's/-userdebug//' | sed "s/cm-11.0.*//"
	fi

	if [ $script_repo == "evervolv" ]; then
		cat $REPOS/evervolv-$repo_platform/vendor/ev/vendorsetup.sh | grep "add_lunch_combo" | \
		sed 's/.*ev_//' | sed 's/-eng//' | sed "/combo.*/d"
	fi

	if [ $script_repo == "omni" ]; then
		for vendorsetup in `ls $REPOS/omni-$repo_platform/script_device/*/*/vendorsetup.sh 2> /dev/null`
		do
			cat $vendorsetup | grep "add_lunch_combo" | sed 's/.*custom_//' | \
			sed 's/-userdebug//' | sed 's/.*full_//' | sed "/combo.*/d"
		done
	fi

	if [ $script_repo == "pacman" ]; then
		cat $REPOS/pacman-$repo_platform/vendor/pac/vendorsetup.sh | grep "add_lunch_combo" | \
		sed 's/.*pac_//' | sed 's/-userdebug//' | sed "/combo.*/d"
	fi

	if [ $script_repo == "paranoid" ]; then
		cat $REPOS/paranoid-$repo_platform/vendor/pa/vendorsetup.sh | grep "add_lunch_combo" | \
		sed 's/.*pa_//' | sed 's/-userdebug//' | sed "/combo.*/d"
	fi

	echo ""

	echo "Swordrune10's Android Kitchen!"
	echo "=============================="
	echo "Please type in which device you would like to build"
	echo "Type in list to see all supported devices"
	echo "Type in exit to go to back"
	read script_device
done

if [ $script_device == "exit" ]; then
	read -p "Press Enter to continue: " done
	exit 0
fi

if [ $script_repo == "aokp" ]; then
	if ( ! sed -e 's/.*aokp_//g' \
	-e 's/-userdebug//' \
	$REPOS/aokp-$repo_platform/vendor/aokp/vendorsetup.sh | grep -q $script_device ); then
		echo ""
		echo "This device is not compatible with this repository, try again!"
		read -p "Returning to Build Menu, Press Enter to continue: " done
		exit 0
	fi
fi

if [ $script_repo == "aosp" ]; then
	if ( ! sed -e 's/.*aosp_//g' \
	-e 's/-userdebug//' \
	$REPOS/aosp-$repo_platform/device/*/$script_device/vendorsetup.sh | grep -q $script_device ); then
		echo ""
		echo "This device is not compatible with this repository, try again!"
		read -p "Returning to Build Menu, Press Enter to continue: " done
		exit 0
	fi	
fi

if [ $script_repo == "carbon" ]; then
	if ( ! sed -e 's/.*carbon_//g' \
	-e 's/-userdebug//' \
	$REPOS/carbon-$repo_platform/vendor/carbon/vendorsetup.sh | grep -q $script_device ); then
		echo ""
		echo "This device is not compatible with this repository, try again!"
		read -p "Returning to Build Menu, Press Enter to continue: " done
		exit 0
	fi	
fi

if [ $script_repo == "cm" ]; then
	if ( ! cat $LOCAL/config/cm-master-list | grep -q $script_device ); then
		echo ""
		echo "This device is not compatible with this repository, try again!"
		read -p "Returning to Build Menu, Press Enter to continue: " done
		exit 0
	fi
fi

if [ $script_repo == "evervolv" ]; then
	if ( ! sed -e 's/.*ev_//g' \
	-e 's/-userdebug//' \
	$REPOS/evervolv-$repo_platform/vendor/ev/vendorsetup.sh | grep -q $script_device ); then
		echo ""
		echo "This device is not compatible with this repository, try again!"
		read -p "Returning to Build Menu, Press Enter to continue: " done
		exit 0
	fi
fi

if [ $script_repo == "omni" ]; then
	if ( ! sed -e 's/.*custom_//g' \
	-e 's/-userdebug//' \
	$REPOS/omni-$repo_platform/device/*/$script_device/vendorsetup.sh | grep -q $script_device ); then
		echo ""
		echo "This device is not compatible with this repository, try again!"
		read -p "Returning to Build Menu, Press Enter to continue: " done
		exit 0
	fi	
fi

if [ $script_repo == "pacman" ]; then
	if ( ! sed -e 's/.*pac_//g' \
	-e 's/-userdebug//' \
	$REPOS/pacman-$repo_platform/vendor/pac/vendorsetup.sh | grep -q $script_device ); then
		echo ""
		echo "This device is not compatible with this repository, try again!"
		read -p "Returning to Build Menu, Press Enter to continue: " done
		exit 0
	fi
fi

if [ $script_repo == "paranoid" ]; then
	if ( ! sed -e 's/.*pa_//g' \
	-e 's/-userdebug//' \
	$REPOS/paranoid-$repo_platform/vendor/pa/vendorsetup.sh | grep -q $script_device ); then
		echo ""
		echo "This device is not compatible with this repository, try again!"
		read -p "Returning to Build Menu, Press Enter to continue: " done
		exit 0
	fi
fi

. buildandro

exit 0
}
menu
