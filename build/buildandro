#!/bin/bash
# Written by Sean Donovan (swordrune10)
if [ ! "$OTHER_REPO_FOLDER" == "" ]; then
	outfolder=$(echo "$OTHER_REPO_FOLDER/out/target/product/$SCRIPT_DEVICE/system")
else
	outfolder=$(echo "$REPOS/$SCRIPT_REPO-$REPO_PLATFORM/out/target/product/$SCRIPT_DEVICE/system")
fi

if ( find $outfolder/build.prop &> /dev/null ); then
	rm $outfolder/build.prop
fi
cd ..
if ( find $outfolder/*.zip &> /dev/null ); then
	rm $outfolder/*.zip*
fi

if [ ! "$OTHER_REPO_FOLDER" == "" ]; then
	cd $OTHER_REPO_FOLDER
else
	cd $REPOS/$SCRIPT_REPO-$REPO_PLATFORM
fi

. build/envsetup.sh

if [ $SCRIPT_REPO == "cm" ] || [ $SCRIPT_REPO == "sts" ]; then
	brunch $SCRIPT_DEVICE -j$THREADS_TOTAL
	exit 0
fi

if [ $SCRIPT_REPO == "aokp" ]; then
	vendor_lunch=$(echo "aokp_")
fi

if [ $SCRIPT_REPO == "evervolv" ]; then
	vendor_lunch=$(echo "ev_")
fi

if [ $SCRIPT_REPO == "gummy" ]; then
	vendor_lunch=$(echo "Gummy_")
fi

if [ $SCRIPT_REPO == "aosp" ] || [ $SCRIPT_REPO == "rooted-aosp" ]; then
	vendor_lunch=$(echo "full_")
fi

lunch $vendor_lunch$SCRIPT_DEVICE-userdebug
make CC=gcc-4.4 CXX=g++-4.4 otapackage -j$THREADS_TOTAL
