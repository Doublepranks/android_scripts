#!/bin/bash
# Written by Sean Donovan (swordrune10)

if [ ! "$INIT" ]; then
	parameter=$(echo "$1")
fi

if [ "$parameter" ]; then
	export AUTO=true
fi

if [ ! "$INIT" ]; then
	cd $(dirname $0)
	export SCRIPT=$(echo "reposync")
	../headerfile
	exit 0
fi

menu () {
supersync=$( expr $THREADS_TOTAL \* 2 )

if [ ! "$AUTO" ]; then
	clear

	echo "Swordrune10's Android Kitchen!"
	echo "=============================="
	echo "What are we updating?"
	echo "  1. Update the Kitchen app repository"
	echo "  2. Update the Android Open Kang Project repository"
	echo "  3. Update the Android Open Source Project repository"
	echo "  4. Update the BAMF Paradigm repository"
	echo "  5. Update the Bugless Beast repository"
	echo "  6. Update the Codename Android repository"
	echo "  7. Update the Cyanogenmod 9 repository"
	echo "  8. Update the Cyanogenmod 10 repository"
	echo "  9. Update the Cyanogenmod 10.2 repository"
	echo "  10. Update the Evervolv repository"
	echo "  11. Update the ParanoidAndroid repository"
	echo "  12. Update the Rooted & Busyboxed AOSP repository"
	echo "  13. Update the Team Gummy repository"
	echo "  14. Update all available repositories"
	echo "  15. Go Back"
	read version

	if [ ! "$version" ] || ( echo $version | grep -q [A-Za-z] ) || [ $version -gt "15" ]; then
		echo ""
		echo "You did not make a proper selection, try again!"
		read -p "Press Enter to continue: " done
		menu
	fi
fi

if [ "$parameter" ]; then
	if [ $parameter == "list" ]; then
		echo "kitchen = Update Kitchen"
		echo "aokp = Update Android Open Kang Project"
		echo "aosp = Update Android Open Source Project"
		echo "bamf = Update BAMF Paradigm"
		echo "bugless = Update Bugless Beast"
		echo "cna = Update Codename Android"
		echo "cm9 = Update Cyanogenmod 9"
		echo "cm10 = Update Cyanogenmod 10"
		echo "cm = Update Cyanogenmod 10.2"
		echo "ev = Update Evervolv"
		echo "paranoid = Update ParanoidAndroid"
		echo "raosp = Update Rooted & Busyboxed AOSP"
		echo "gummy = Update Team Gummy"
		echo "all = Update all available repos"
		exit 0
	fi

	if [ $parameter == "kitchen" ]; then
		version="1"
	fi

	if [ $parameter == "aokp" ]; then
		version="2"
	fi

	if [ $parameter == "aosp" ]; then
		version="3"
	fi

	if [ $parameter == "bamf" ]; then
		version="4"
	fi

	if [ $parameter == "bugless" ]; then
		version="5"
	fi

	if [ $parameter == "cna" ]; then
		version="6"
	fi

	if [ $parameter == "cm9" ]; then
		version="7"
	fi

	if [ $parameter == "cm10" ]; then
		version="8"
	fi

	if [ $parameter == "cm" ]; then
		version="9"
	fi

	if [ $parameter == "ev" ] || [ $parameter == "evervolv" ]; then
		version="10"
	fi

	if [ $parameter == "paranoid" ]; then
		version="11"
	fi

	if [ $parameter == "raosp" ]; then
		version="12"
	fi

	if [ $parameter == "gummy" ]; then
		version="13"
	fi

	if [ $parameter == "all" ]; then
		version="14"
	fi
fi

synccode() {
export repo_folder=$( echo "$REPOS/$script_repo-$repo_platform" )
if ( find $repo_folder/.repo &> /dev/null); then
	echo ""
	echo "Updating $repo_name repository.."
	cd $repo_folder

	preupdate
	repo sync -j$supersync

	$LOCAL/config/gitpuller

	postupdate

	echo ""
	echo "$repo_name Update Complete!"

	if [ ! "$AUTO" ]; then
		read -p "Press Enter to continue: " done
	fi
else
	if [ ! "$AUTO" ]; then
		echo ""
		echo "$repo_name not initialized, do you want to initialize it?"
		read init
	
		if [ "$init" == "yes" ] || [ "$init" == "y" ]; then
			INIT=""
			reposync $script_repo
		else
			read -p "$repo_name wasn't initialized, Press Enter to continue: " done
			menu
		fi
	else
		echo ""
		echo "$repo_name not initialized, aborting.."
	fi
fi
}

if [ $version == "1" ] || [ $version == "14" ]; then
	echo ""
	echo "Updating the Kitchen app repository.."
	cd $LOCAL/..

	repo sync -j$THREADS_TOTAL
	echo ""
	echo "Kitchen Update Complete!"

	if [ ! "$AUTO" ]; then
		read -p "Press Enter to continue: " done
	fi
fi

if [ $version == "2" ]; then
	script_repo=$(echo "aokp")
	repo_platform=$(echo "jb")
	repo_name=$(echo "Android Open Kang Project")
	synccode
fi

if [ $version == "3" ]; then
	script_repo=$(echo "aosp")
	repo_platform=$(echo "jb")
	repo_name=$(echo "Android Open Source Project")
	synccode
fi

if [ $version == "4" ]; then
	script_repo=$(echo "bamf")
	repo_platform=$(echo "jb")
	repo_name=$(echo "BAMF Paradigm")
	synccode
fi

if [ $version == "5" ]; then
	script_repo=$(echo "bugless")
	repo_platform=$(echo "jb")
	repo_name=$(echo "Bugless Beast")
	synccode
fi

if [ $version == "6" ]; then
	script_repo=$(echo "cna")
	repo_platform=$(echo "jb")
	repo_name=$(echo "Codename Android")
	synccode
fi

if [ $version == "7" ]; then
	script_repo=$(echo "cm")
	repo_platform=$(echo "ics")
	repo_name=$(echo "Cyanogenmod 9")
	synccode
fi

if [ $version == "8" ]; then
	script_repo=$(echo "cm")
	repo_platform=$(echo "jb")
	repo_name=$(echo "Cyanogenmod 10")
	synccode
fi

if [ $version == "9" ]; then
	script_repo=$(echo "cm")
	repo_platform=$(echo "10.2")
	repo_name=$(echo "Cyanogenmod 10.2")
	synccode
fi

if [ $version == "10" ]; then
	script_repo=$(echo "evervolv")
	repo_platform=$(echo "jb")
	repo_name=$(echo "Evervolv")
	synccode
fi

if [ $version == "11" ]; then
	script_repo=$(echo "paranoid")
	repo_platform=$(echo "jb")
	repo_name=$(echo "ParanoidAndroid")
	synccode
fi

if [ $version == "12" ]; then
	script_repo=$(echo "raosp")
	repo_platform=$(echo "jb")
	repo_name=$(echo "Rooted & Busyboxed AOSP")
	synccode
fi

if [ $version == "13" ]; then
	script_repo=$(echo "gummy")
	repo_platform=$(echo "jb")
	repo_name=$(echo "Team Gummy")
	synccode
fi

if [ $version == "14" ]; then
	script_repo=$(echo "aokp")
	repo_platform=$(echo "jb")
	repo_name=$(echo "Android Open Kang Project")
	synccode
	script_repo=$(echo "aosp")
	repo_platform=$(echo "jb")
	repo_name=$(echo "Android Open Source Project")
	synccode
	script_repo=$(echo "bamf")
	repo_platform=$(echo "jb")
	repo_name=$(echo "BAMF Paradigm")
	synccode
	script_repo=$(echo "bugless")
	repo_platform=$(echo "jb")
	repo_name=$(echo "Bugless Beast")
	synccode
	script_repo=$(echo "cna")
	repo_platform=$(echo "jb")
	repo_name=$(echo "Codename Android")
	synccode
	script_repo=$(echo "cm")
	repo_platform=$(echo "ics")
	repo_name=$(echo "Cyanogenmod 9")
	synccode
	script_repo=$(echo "cm")
	repo_platform=$(echo "jb")
	repo_name=$(echo "Cyanogenmod 10")
	synccode
	script_repo=$(echo "cm")
	repo_platform=$(echo "10.2")
	repo_name=$(echo "Cyanogenmod 10.2")
	synccode
	script_repo=$(echo "evervolv")
	repo_platform=$(echo "jb")
	repo_name=$(echo "Evervolv")
	synccode
	script_repo=$(echo "paranoid")
	repo_platform=$(echo "jb")
	repo_name=$(echo "ParanoidAndroid")
	synccode
	script_repo=$(echo "raosp")
	repo_platform=$(echo "jb")
	repo_name=$(echo "Rooted & Busyboxed AOSP")
	synccode
	script_repo=$(echo "gummy")
	repo_platform=$(echo "jb")
	repo_name=$(echo "Team Gummy")
	synccode
fi

if [ $version == "15" ]; then
	echo ""
	read -p "Returning to Main Menu, Press Enter to continue: " done
	exit 0
fi

if [ $AUTO ]; then
	exit 0
fi

menu
}
menu
